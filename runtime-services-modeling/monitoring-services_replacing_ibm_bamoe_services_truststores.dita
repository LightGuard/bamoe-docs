<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE topic
 PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="_replacing_ibm_bamoe_services_truststores">
   <title>Replacing IBM BAMOE services TrustStores</title>
   <body>
      <title>Replacing IBM BAMOE services TrustStores</title>
      <p>You can replace the default Java TrustStore that comes in IBM BAMOE images. Replacement of Java TrustStore is required when a given IBM BAMOE service makes HTTPS calls to services that require encrypted connections using a private <xref href="https://dzone.com/articles/understanding-the-role-of-certificate-authorities" scope="external">Certificate Authority (CA)</xref>.</p>
      <p outputclass="title">
         <b>Prerequisites</b>
      </p>
      <ul>
         <li>The Java TrustStore replaces the default one. You must add the trusted certificates to the default JKS. As an alternative, you can create a new TrustStore that consists of the required IBM BAMOE service certificates.</li>
      </ul>
      <note type="note">
Any IBM BAMOE service that is deployed in a given namespace can access the Java TrustStore if required.
</note>
      <p>To manipulate the Java TrustStore, you can use <xref href="https://keystore-explorer.org/" scope="external">KeyExplorer</xref> or <xref href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html" scope="external">keytool</xref> that consists of JDK.</p>
      <p outputclass="title">
         <b>Procedure</b>
      </p>
      <ol>
         <li>
            <p>Create a <xref href="https://kubernetes.io/docs/tasks/configmap-secret/managing-secret-using-config-file/" scope="external">Kubernetes Secret</xref> based on the customized Java TrustStore:</p>
            <div>
               <p outputclass="title">
                  <b>Example Kuberbetes Secret</b>
               </p>
               <codeblock>
$ oc create secret generic kogito-truststore --from-file=cacerts=&lt;path to your JKS&gt; --from-literal=keyStorePassword=&lt;TrustStore Password&gt;
</codeblock>
            </div>
            <p>You must define the secret keys as shown in the previous command. <tt>cacerts</tt> is used for the TrustStore file and <tt>keyStorePassword</tt> is used for the TrustStore password.</p>
         </li>
         <li>
            <p>Deploy the IBM BAMOE service that uses the TrustStore. For example:</p>
            <div>
               <p outputclass="title">
                  <b>Example IBM BAMOE service deployment</b>
               </p>
               <codeblock outputclass="language-yaml">
piVersion: app.kiegroup.org/v1beta1
kind: KogitoRuntime
metadata:
  name: my-service
spec:
  replicas: 1
  image: quay.io/my-namespace/my-service:latest
  trustStoreSecret: kogito-truststore
</codeblock>
            </div>
         </li>
      </ol>
   </body>
</topic>